#!/usr/bin/env node
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const cdk = require("@aws-cdk/core");
const aws_ec2_1 = require("@aws-cdk/aws-ec2");
const aws_eks_1 = require("@aws-cdk/aws-eks");
// Blueprint
const eks_blueprint_stack_1 = require("../lib/stacks/eks-blueprint-stack");
// Addons 
const addon = require("../lib/addons");
// Cluster Providers
const fargate_cluster_provider_1 = require("../lib/cluster-providers/fargate-cluster-provider");
const ec2_cluster_provider_1 = require("../lib/cluster-providers/ec2-cluster-provider");
// Pipeline
const pipeline_stack_1 = require("../lib/stacks/pipeline-stack");
// Teams
const setup_1 = require("../lib/teams/team-burnham/setup");
const setup_2 = require("../lib/teams/team-riker/setup");
const setup_3 = require("../lib/teams/team-troi/setup");
const app = new cdk.App();
const addOns = [
    new addon.CalicoAddon,
    new addon.MetricsServerAddon,
    new addon.ClusterAutoScalerAddon,
    new addon.ContainerInsightsAddOn,
    new addon.NginxAddon,
    new addon.ArgoCDAddon
];
const allTeams = [
    new setup_3.TeamTroiSetup,
    new setup_2.TeamRikerSetup,
    new setup_1.TeamBurnhamSetup
];
new pipeline_stack_1.PipelineStack(app, "factory-pipeline", {
    env: {
        account: "929819487611",
        region: 'us-east-2'
    },
});
new eks_blueprint_stack_1.CdkEksBlueprintStack(app, { id: 'east-dev', addOns: addOns, teams: allTeams }, {
    env: {
        region: 'us-east-2'
    },
});
new eks_blueprint_stack_1.CdkEksBlueprintStack(app, { id: 'west-dev', addOns: addOns, teams: allTeams }, {
    env: {
        region: 'us-west-2'
    },
});
new eks_blueprint_stack_1.CdkEksBlueprintStack(app, { id: 'east-test-main', addOns: addOns }, {
    env: {
        account: '929819487611',
        region: 'us-east-1',
    },
});
const fargateProfiles = new Map([
    ["dynatrace", { selectors: [{ namespace: "dynatrace" }] }]
]);
new eks_blueprint_stack_1.CdkEksBlueprintStack(app, { id: 'east-fargate-test', clusterProvider: new fargate_cluster_provider_1.FargateClusterProvider(fargateProfiles) }, {
    env: {
        region: 'us-east-1'
    }
});
class BottlerocketClusterProvider {
    createCluster(scope, vpc, version) {
        const cluster = new aws_eks_1.Cluster(scope, scope.node.id, {
            vpc: vpc,
            clusterName: scope.node.id,
            outputClusterName: true,
            defaultCapacity: 0,
            version: version,
        });
        const nodeGroup = cluster.addAutoScalingGroupCapacity('BottlerocketNodes', {
            instanceType: new aws_ec2_1.InstanceType('t3.small'),
            minCapacity: 2,
            machineImageType: aws_eks_1.MachineImageType.BOTTLEROCKET
        });
        return { cluster: cluster, autoscalingGroup: nodeGroup, version };
    }
}
new eks_blueprint_stack_1.CdkEksBlueprintStack(app, { id: 'east-br-test', clusterProvider: new BottlerocketClusterProvider }, {
    env: {
        region: 'us-east-1'
    }
});
const props = {
    version: aws_eks_1.KubernetesVersion.V1_19,
    instanceType: new aws_ec2_1.InstanceType('t3.large'),
    amiType: aws_eks_1.NodegroupAmiType.AL2_X86_64
};
const myClusterProvider = new ec2_cluster_provider_1.EC2ClusterProvider(props);
new eks_blueprint_stack_1.CdkEksBlueprintStack(app, { id: "test-cluster-provider", clusterProvider: myClusterProvider });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uL2Jpbi9tYWluLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7OztBQUNBLHFDQUFxQztBQUNyQyw4Q0FBc0Q7QUFDdEQsOENBQXlIO0FBRXpILFlBQVk7QUFDWiwyRUFBZ0k7QUFFaEksVUFBVTtBQUNWLHVDQUFzQztBQUV0QyxvQkFBb0I7QUFDcEIsZ0dBQTJGO0FBQzNGLHdGQUE0RztBQUU1RyxXQUFXO0FBQ1gsaUVBQTZEO0FBRTdELFFBQVE7QUFDUiwyREFBbUU7QUFDbkUseURBQStEO0FBQy9ELHdEQUE2RDtBQUU3RCxNQUFNLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxHQUFHLEVBQUUsQ0FBQztBQUUxQixNQUFNLE1BQU0sR0FBd0I7SUFDaEMsSUFBSSxLQUFLLENBQUMsV0FBVztJQUNyQixJQUFJLEtBQUssQ0FBQyxrQkFBa0I7SUFDNUIsSUFBSSxLQUFLLENBQUMsc0JBQXNCO0lBQ2hDLElBQUksS0FBSyxDQUFDLHNCQUFzQjtJQUNoQyxJQUFJLEtBQUssQ0FBQyxVQUFVO0lBQ3BCLElBQUksS0FBSyxDQUFDLFdBQVc7Q0FDeEIsQ0FBQztBQUVGLE1BQU0sUUFBUSxHQUFxQjtJQUMvQixJQUFJLHFCQUFhO0lBQ2pCLElBQUksc0JBQWM7SUFDbEIsSUFBSSx3QkFBZ0I7Q0FDdkIsQ0FBQztBQUVGLElBQUksOEJBQWEsQ0FBQyxHQUFHLEVBQUUsa0JBQWtCLEVBQUU7SUFDdkMsR0FBRyxFQUFFO1FBQ0QsT0FBTyxFQUFFLGNBQWM7UUFDdkIsTUFBTSxFQUFFLFdBQVc7S0FDdEI7Q0FDSixDQUFDLENBQUM7QUFFSCxJQUFJLDBDQUFvQixDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUU7SUFDL0UsR0FBRyxFQUFFO1FBQ0QsTUFBTSxFQUFFLFdBQVc7S0FDdEI7Q0FDSixDQUFDLENBQUM7QUFFSCxJQUFJLDBDQUFvQixDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxVQUFVLEVBQUUsTUFBTSxFQUFFLE1BQU0sRUFBRSxLQUFLLEVBQUUsUUFBUSxFQUFFLEVBQUU7SUFDL0UsR0FBRyxFQUFFO1FBQ0QsTUFBTSxFQUFFLFdBQVc7S0FDdEI7Q0FDSixDQUFDLENBQUM7QUFFSCxJQUFJLDBDQUFvQixDQUFDLEdBQUcsRUFBRSxFQUFFLEVBQUUsRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLEVBQUUsTUFBTSxFQUFFLEVBQUU7SUFDcEUsR0FBRyxFQUFFO1FBQ0QsT0FBTyxFQUFFLGNBQWM7UUFDdkIsTUFBTSxFQUFFLFdBQVc7S0FDdEI7Q0FDSixDQUFDLENBQUM7QUFFSCxNQUFNLGVBQWUsR0FBdUMsSUFBSSxHQUFHLENBQUM7SUFDaEUsQ0FBQyxXQUFXLEVBQUUsRUFBRSxTQUFTLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxXQUFXLEVBQUUsQ0FBQyxFQUFFLENBQUM7Q0FDN0QsQ0FBQyxDQUFDO0FBRUgsSUFBSSwwQ0FBb0IsQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsbUJBQW1CLEVBQUUsZUFBZSxFQUFFLElBQUksaURBQXNCLENBQUMsZUFBZSxDQUFDLEVBQUUsRUFBRTtJQUNySCxHQUFHLEVBQUU7UUFDRCxNQUFNLEVBQUUsV0FBVztLQUN0QjtDQUNKLENBQUMsQ0FBQTtBQUVGLE1BQU0sMkJBQTJCO0lBQzdCLGFBQWEsQ0FBQyxLQUFvQixFQUFFLEdBQVMsRUFBRSxPQUEwQjtRQUVyRSxNQUFNLE9BQU8sR0FBRyxJQUFJLGlCQUFPLENBQUMsS0FBSyxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRSxFQUFFO1lBQzlDLEdBQUcsRUFBRSxHQUFHO1lBQ1IsV0FBVyxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsRUFBRTtZQUMxQixpQkFBaUIsRUFBRSxJQUFJO1lBQ3ZCLGVBQWUsRUFBRSxDQUFDO1lBQ2xCLE9BQU8sRUFBRSxPQUFPO1NBQ25CLENBQUMsQ0FDRztRQUNMLE1BQU0sU0FBUyxHQUFHLE9BQU8sQ0FBQywyQkFBMkIsQ0FBQyxtQkFBbUIsRUFBRTtZQUN2RSxZQUFZLEVBQUUsSUFBSSxzQkFBWSxDQUFDLFVBQVUsQ0FBQztZQUMxQyxXQUFXLEVBQUUsQ0FBQztZQUNkLGdCQUFnQixFQUFFLDBCQUFnQixDQUFDLFlBQVk7U0FDbEQsQ0FBQyxDQUFDO1FBRUgsT0FBTyxFQUFFLE9BQU8sRUFBRSxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsU0FBUyxFQUFFLE9BQU8sRUFBRSxDQUFBO0lBRXJFLENBQUM7Q0FDSjtBQUVELElBQUksMENBQW9CLENBQUMsR0FBRyxFQUFFLEVBQUUsRUFBRSxFQUFFLGNBQWMsRUFBRSxlQUFlLEVBQUUsSUFBSSwyQkFBMkIsRUFBRSxFQUFFO0lBQ3BHLEdBQUcsRUFBRTtRQUNELE1BQU0sRUFBRSxXQUFXO0tBQ3RCO0NBQ0osQ0FBQyxDQUFBO0FBRUYsTUFBTSxLQUFLLEdBQTRCO0lBQ25DLE9BQU8sRUFBRSwyQkFBaUIsQ0FBQyxLQUFLO0lBQ2hDLFlBQVksRUFBRSxJQUFJLHNCQUFZLENBQUMsVUFBVSxDQUFDO0lBQzFDLE9BQU8sRUFBRSwwQkFBZ0IsQ0FBQyxVQUFVO0NBQ3ZDLENBQUE7QUFFRCxNQUFNLGlCQUFpQixHQUFHLElBQUkseUNBQWtCLENBQUMsS0FBSyxDQUFDLENBQUM7QUFFeEQsSUFBSSwwQ0FBb0IsQ0FBQyxHQUFHLEVBQUUsRUFBRSxFQUFFLEVBQUUsdUJBQXVCLEVBQUUsZUFBZSxFQUFFLGlCQUFpQixFQUFFLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIiMhL3Vzci9iaW4vZW52IG5vZGVcbmltcG9ydCAqIGFzIGNkayBmcm9tICdAYXdzLWNkay9jb3JlJztcbmltcG9ydCB7IEluc3RhbmNlVHlwZSwgSVZwYyB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1lYzInO1xuaW1wb3J0IHsgQ2x1c3RlciwgRmFyZ2F0ZVByb2ZpbGVPcHRpb25zLCBLdWJlcm5ldGVzVmVyc2lvbiwgTWFjaGluZUltYWdlVHlwZSwgTm9kZWdyb3VwQW1pVHlwZSB9IGZyb20gJ0Bhd3MtY2RrL2F3cy1la3MnO1xuXG4vLyBCbHVlcHJpbnRcbmltcG9ydCB7IENka0Vrc0JsdWVwcmludFN0YWNrLCBDbHVzdGVyQWRkT24sIENsdXN0ZXJJbmZvLCBDbHVzdGVyUHJvdmlkZXIsIFRlYW1TZXR1cCB9IGZyb20gJy4uL2xpYi9zdGFja3MvZWtzLWJsdWVwcmludC1zdGFjayc7XG5cbi8vIEFkZG9ucyBcbmltcG9ydCAqIGFzIGFkZG9uIGZyb20gJy4uL2xpYi9hZGRvbnMnXG5cbi8vIENsdXN0ZXIgUHJvdmlkZXJzXG5pbXBvcnQgeyBGYXJnYXRlQ2x1c3RlclByb3ZpZGVyIH0gZnJvbSAnLi4vbGliL2NsdXN0ZXItcHJvdmlkZXJzL2ZhcmdhdGUtY2x1c3Rlci1wcm92aWRlcic7XG5pbXBvcnQgeyBFQzJDbHVzdGVyUHJvdmlkZXIsIEVDMlByb3ZpZGVyQ2x1c3RlclByb3BzIH0gZnJvbSAnLi4vbGliL2NsdXN0ZXItcHJvdmlkZXJzL2VjMi1jbHVzdGVyLXByb3ZpZGVyJztcblxuLy8gUGlwZWxpbmVcbmltcG9ydCB7IFBpcGVsaW5lU3RhY2sgfSBmcm9tICcuLi9saWIvc3RhY2tzL3BpcGVsaW5lLXN0YWNrJztcblxuLy8gVGVhbXNcbmltcG9ydCB7IFRlYW1CdXJuaGFtU2V0dXAgfSBmcm9tICcuLi9saWIvdGVhbXMvdGVhbS1idXJuaGFtL3NldHVwJztcbmltcG9ydCB7IFRlYW1SaWtlclNldHVwIH0gZnJvbSAnLi4vbGliL3RlYW1zL3RlYW0tcmlrZXIvc2V0dXAnO1xuaW1wb3J0IHsgVGVhbVRyb2lTZXR1cCB9IGZyb20gJy4uL2xpYi90ZWFtcy90ZWFtLXRyb2kvc2V0dXAnO1xuXG5jb25zdCBhcHAgPSBuZXcgY2RrLkFwcCgpO1xuXG5jb25zdCBhZGRPbnM6IEFycmF5PENsdXN0ZXJBZGRPbj4gPSBbXG4gICAgbmV3IGFkZG9uLkNhbGljb0FkZG9uLFxuICAgIG5ldyBhZGRvbi5NZXRyaWNzU2VydmVyQWRkb24sXG4gICAgbmV3IGFkZG9uLkNsdXN0ZXJBdXRvU2NhbGVyQWRkb24sXG4gICAgbmV3IGFkZG9uLkNvbnRhaW5lckluc2lnaHRzQWRkT24sXG4gICAgbmV3IGFkZG9uLk5naW54QWRkb24sXG4gICAgbmV3IGFkZG9uLkFyZ29DREFkZG9uXG5dO1xuXG5jb25zdCBhbGxUZWFtczogQXJyYXk8VGVhbVNldHVwPiA9IFtcbiAgICBuZXcgVGVhbVRyb2lTZXR1cCxcbiAgICBuZXcgVGVhbVJpa2VyU2V0dXAsXG4gICAgbmV3IFRlYW1CdXJuaGFtU2V0dXBcbl07XG5cbm5ldyBQaXBlbGluZVN0YWNrKGFwcCwgXCJmYWN0b3J5LXBpcGVsaW5lXCIsIHtcbiAgICBlbnY6IHtcbiAgICAgICAgYWNjb3VudDogXCI5Mjk4MTk0ODc2MTFcIixcbiAgICAgICAgcmVnaW9uOiAndXMtZWFzdC0yJ1xuICAgIH0sXG59KTtcblxubmV3IENka0Vrc0JsdWVwcmludFN0YWNrKGFwcCwgeyBpZDogJ2Vhc3QtZGV2JywgYWRkT25zOiBhZGRPbnMsIHRlYW1zOiBhbGxUZWFtcyB9LCB7XG4gICAgZW52OiB7XG4gICAgICAgIHJlZ2lvbjogJ3VzLWVhc3QtMidcbiAgICB9LFxufSk7XG5cbm5ldyBDZGtFa3NCbHVlcHJpbnRTdGFjayhhcHAsIHsgaWQ6ICd3ZXN0LWRldicsIGFkZE9uczogYWRkT25zLCB0ZWFtczogYWxsVGVhbXMgfSwge1xuICAgIGVudjoge1xuICAgICAgICByZWdpb246ICd1cy13ZXN0LTInXG4gICAgfSxcbn0pO1xuXG5uZXcgQ2RrRWtzQmx1ZXByaW50U3RhY2soYXBwLCB7IGlkOiAnZWFzdC10ZXN0LW1haW4nLCBhZGRPbnM6IGFkZE9ucyB9LCB7XG4gICAgZW52OiB7XG4gICAgICAgIGFjY291bnQ6ICc5Mjk4MTk0ODc2MTEnLFxuICAgICAgICByZWdpb246ICd1cy1lYXN0LTEnLFxuICAgIH0sXG59KTtcblxuY29uc3QgZmFyZ2F0ZVByb2ZpbGVzOiBNYXA8c3RyaW5nLCBGYXJnYXRlUHJvZmlsZU9wdGlvbnM+ID0gbmV3IE1hcChbXG4gICAgW1wiZHluYXRyYWNlXCIsIHsgc2VsZWN0b3JzOiBbeyBuYW1lc3BhY2U6IFwiZHluYXRyYWNlXCIgfV0gfV1cbl0pO1xuXG5uZXcgQ2RrRWtzQmx1ZXByaW50U3RhY2soYXBwLCB7IGlkOiAnZWFzdC1mYXJnYXRlLXRlc3QnLCBjbHVzdGVyUHJvdmlkZXI6IG5ldyBGYXJnYXRlQ2x1c3RlclByb3ZpZGVyKGZhcmdhdGVQcm9maWxlcykgfSwge1xuICAgIGVudjoge1xuICAgICAgICByZWdpb246ICd1cy1lYXN0LTEnXG4gICAgfVxufSlcblxuY2xhc3MgQm90dGxlcm9ja2V0Q2x1c3RlclByb3ZpZGVyIGltcGxlbWVudHMgQ2x1c3RlclByb3ZpZGVyIHtcbiAgICBjcmVhdGVDbHVzdGVyKHNjb3BlOiBjZGsuQ29uc3RydWN0LCB2cGM6IElWcGMsIHZlcnNpb246IEt1YmVybmV0ZXNWZXJzaW9uKTogQ2x1c3RlckluZm8ge1xuXG4gICAgICAgIGNvbnN0IGNsdXN0ZXIgPSBuZXcgQ2x1c3RlcihzY29wZSwgc2NvcGUubm9kZS5pZCwge1xuICAgICAgICAgICAgdnBjOiB2cGMsXG4gICAgICAgICAgICBjbHVzdGVyTmFtZTogc2NvcGUubm9kZS5pZCxcbiAgICAgICAgICAgIG91dHB1dENsdXN0ZXJOYW1lOiB0cnVlLFxuICAgICAgICAgICAgZGVmYXVsdENhcGFjaXR5OiAwLCAvLyB3ZSB3YW50IHRvIG1hbmFnZSBjYXBhY2l0eSBvdXJzZWx2ZXNcbiAgICAgICAgICAgIHZlcnNpb246IHZlcnNpb24sXG4gICAgICAgIH0pXG4gICAgICAgICAgICA7XG4gICAgICAgIGNvbnN0IG5vZGVHcm91cCA9IGNsdXN0ZXIuYWRkQXV0b1NjYWxpbmdHcm91cENhcGFjaXR5KCdCb3R0bGVyb2NrZXROb2RlcycsIHtcbiAgICAgICAgICAgIGluc3RhbmNlVHlwZTogbmV3IEluc3RhbmNlVHlwZSgndDMuc21hbGwnKSxcbiAgICAgICAgICAgIG1pbkNhcGFjaXR5OiAyLFxuICAgICAgICAgICAgbWFjaGluZUltYWdlVHlwZTogTWFjaGluZUltYWdlVHlwZS5CT1RUTEVST0NLRVRcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHsgY2x1c3RlcjogY2x1c3RlciwgYXV0b3NjYWxpbmdHcm91cDogbm9kZUdyb3VwLCB2ZXJzaW9uIH1cblxuICAgIH1cbn1cblxubmV3IENka0Vrc0JsdWVwcmludFN0YWNrKGFwcCwgeyBpZDogJ2Vhc3QtYnItdGVzdCcsIGNsdXN0ZXJQcm92aWRlcjogbmV3IEJvdHRsZXJvY2tldENsdXN0ZXJQcm92aWRlciB9LCB7XG4gICAgZW52OiB7XG4gICAgICAgIHJlZ2lvbjogJ3VzLWVhc3QtMSdcbiAgICB9XG59KVxuXG5jb25zdCBwcm9wczogRUMyUHJvdmlkZXJDbHVzdGVyUHJvcHMgPSB7XG4gICAgdmVyc2lvbjogS3ViZXJuZXRlc1ZlcnNpb24uVjFfMTksXG4gICAgaW5zdGFuY2VUeXBlOiBuZXcgSW5zdGFuY2VUeXBlKCd0My5sYXJnZScpLFxuICAgIGFtaVR5cGU6IE5vZGVncm91cEFtaVR5cGUuQUwyX1g4Nl82NFxufVxuXG5jb25zdCBteUNsdXN0ZXJQcm92aWRlciA9IG5ldyBFQzJDbHVzdGVyUHJvdmlkZXIocHJvcHMpO1xuXG5uZXcgQ2RrRWtzQmx1ZXByaW50U3RhY2soYXBwLCB7IGlkOiBcInRlc3QtY2x1c3Rlci1wcm92aWRlclwiLCBjbHVzdGVyUHJvdmlkZXI6IG15Q2x1c3RlclByb3ZpZGVyIH0pOyJdfQ==